<!doctype html>
<html lang="uk">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–æ—Ä—É</title>

    <style>
        :root{
            --blur: 6px;
        }

        *{ box-sizing:border-box; }

        body{
            margin:0;
            min-height:100vh;
            display:flex;
            align-items:center;
            justify-content:center;
            background:#ffffff;
            color:#000000;
            font-family: Arial, Helvetica, sans-serif;
        }

        .wrap{
            width:min(900px, 95vw);
            padding:24px;
        }

        header{
            display:flex;
            justify-content:space-between;
            align-items:flex-end;
            margin-bottom:16px;
        }

        h1{
            font-size:16px;
            letter-spacing:0.12em;
            text-transform:uppercase;
            margin:0;
        }

        .status{
            font-size:13px;
        }

        .card{
            border:3px solid #000;
            padding:24px 18px;
        }

        /* ===== CHART ===== */

        .chart-area{
            position:relative;
            padding:20px 10px 10px;
            overflow:hidden;
        }

        .chart{
            text-align:center;
            filter: blur(var(--blur));
            transition: filter 200ms linear;
        }

        .line{
            font-weight:700;
            letter-spacing:0.28em;
            margin:14px 0;
            text-transform:uppercase;
        }

        .l1{ font-size:90px; }
        .l2{ font-size:56px; }
        .l3{ font-size:42px; }
        .l4{ font-size:32px; }
        .l5{ font-size:26px; }
        .l6{ font-size:22px; }
        .l7{ font-size:20px; }
        .l8{ font-size:18px; }
        .l9{ font-size:16px; }
        .l10{ font-size:14px; }

        .divider{
            height:6px;
            background:#000;
            margin:22px 0;
        }

        /* blink */
        .blink{
            position:absolute;
            inset:0;
            background:#000;
            opacity:0;
            pointer-events:none;
            transition:opacity 120ms linear;
        }
        .blink.on{ opacity:0.85; }

        .hint{
            text-align:center;
            font-size:14px;
            margin-top:12px;
        }

        /* —Ñ–∏–Ω–∞–ª—å–Ω–∏–π —Ä—è–¥–æ–∫ */
        .final{
            font-size:13px;
            letter-spacing:0.32em;
            margin-top:26px;
            opacity:0;
            transition: opacity 600ms ease;
        }

        /* ===== CONTROLS ===== */

        .controls{
            margin-top:20px;
            border-top:2px solid #000;
            padding-top:16px;
        }

        .row{
            display:flex;
            align-items:center;
            gap:12px;
            margin:10px 0;
            flex-wrap:wrap;
        }

        label{
            min-width:140px;
            font-size:14px;
        }

        input[type="range"]{
            width:280px;
            accent-color:#000;
        }

        button{
            padding:8px 14px;
            font-size:13px;
            border:2px solid #000;
            background:#fff;
            cursor:pointer;
        }

        button.active{
            background:#000;
            color:#fff;
        }

        .readout{
            font-size:14px;
            min-width:110px;
        }

        footer{
            margin-top:14px;
            text-align:right;
            font-size:12px;
        }
    </style>
</head>
<body>
<div class="wrap">
    <header>
        <h1>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–æ—Ä—É</h1>
        <div class="status" id="status">–°—Ç–∞–Ω: –Ω–µ—á—ñ—Ç–∫–æ</div>
    </header>

    <div class="card">
        <!-- CHART -->
        <div class="chart-area">
            <div class="chart" id="chart">
                <div class="line l1">–ó</div>
                <div class="line l2">–î –ù</div>
                <div class="line l3">–ï –ú</div>
                <div class="line l4">–ù –ê –† –û</div>
                <div class="line l5">–î –ñ –ï –ù –ù –Ø</div>

                <div class="divider"></div>

                <div class="line l6">–ù –ï –• –ê –ô</div>
                <div class="line l7">–ë –Ü –õ –¨ –® –ï</div>
                <div class="line l8">–ù –ï  –¢ –† –ï –ë –ê</div>
                <div class="line l9">–ë –£ –î –ï  –ñ –ú –£</div>
                <div class="line l10">–† –ò –¢ –ò –° –¨</div>

                <div class="line final" id="finalLine">
                    –ü –û –î –ê –† –£ –ù –û –ö ‚Äî –õ –ê –ó –ï –† –ù –ê  –ö –û –† –ï –ö –¶ –Ü –Ø  –ó –û –† –£
                </div>
            </div>

            <div class="blink" id="blink"></div>
        </div>

        <div class="hint" id="hint">
            –í—ñ–¥—Ä–µ–≥—É–ª—é–π —Ñ–æ–∫—É—Å —ñ —É—Ç—Ä–∏–º–∞–π —á—ñ—Ç–∫—ñ—Å—Ç—å (—Å–ø–æ—á–∞—Ç–∫—É –ø—Ä–∞–≤–µ –æ–∫–æ, –ø–æ—Ç—ñ–º –ª—ñ–≤–µ)
        </div>

        <!-- CONTROLS -->
        <div class="controls">
            <div class="row">
                <label>–û–∫–æ</label>
                <button id="eyeBtn">–ü–†–ê–í–ï</button>
                <div class="readout" id="eyeDone">–ü–†–ê–í–ï: ‚ùå ‚Ä¢ –õ–Ü–í–ï: ‚ùå</div>
            </div>

            <div class="row">
                <label>–§–æ–∫—É—Å</label>
                <input id="focus" type="range" min="0" max="100" value="20" />
                <div class="readout" id="focusOut">‚Äì</div>
            </div>

            <div class="row">
                <label>–°—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—è</label>
                <button id="stabilize">–£–¢–†–ò–ú–£–í–ê–¢–ò</button>
                <div class="readout" id="hold">0.0 c</div>
            </div>
        </div>

        <footer>–ó –ª—é–±–æ–≤ º—é ‚ù§Ô∏è</footer>
    </div>
</div>

<script>
    const chart = document.getElementById('chart');
    const blink = document.getElementById('blink');
    const status = document.getElementById('status');
    const hint = document.getElementById('hint');

    const eyeBtn = document.getElementById('eyeBtn');
    const eyeDone = document.getElementById('eyeDone');

    const focus = document.getElementById('focus');
    const focusOut = document.getElementById('focusOut');

    const stabilize = document.getElementById('stabilize');
    const holdOut = document.getElementById('hold');

    const finalLine = document.getElementById('finalLine');

    // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ (–∑—Ä–æ–±–ª–µ–Ω–æ –ª–µ–≥—à–µ)
    const TARGET = { R: 62, L: 38 };     // ‚Äú—ñ–¥–µ–∞–ª—å–Ω—ñ‚Äù –∑–Ω–∞—á–µ–Ω–Ω—è —Ñ–æ–∫—É—Å—É
    const BLUR_OK = 1.05;                // –Ω–∞—Å–∫—ñ–ª—å–∫–∏ ‚Äú—á—ñ—Ç–∫–æ‚Äù, —â–æ–± –∑–∞—Ä–∞—Ö–æ–≤—É–≤–∞–ª–æ
    const HOLD_SECONDS = 1.1;            // —Å–∫—ñ–ª—å–∫–∏ —Ç—Ä–∏–º–∞—Ç–∏ —á—ñ—Ç–∫–æ

    let eye = 'R';
    let passed = { R: false, L: false };

    let holding = false;
    let hold = 0;

    function setBlur(px){
        document.documentElement.style.setProperty('--blur', px.toFixed(2) + 'px');
    }

    function isBlinking(){
        return blink.classList.contains('on');
    }

    function updateProgressText(){
        eyeDone.textContent =
            `–ü–†–ê–í–ï: ${passed.R ? '‚úÖ' : '‚ùå'} ‚Ä¢ –õ–Ü–í–ï: ${passed.L ? '‚úÖ' : '‚ùå'}`;
    }

    function update(){
        // blur based on distance to target
        const d = Math.abs(Number(focus.value) - TARGET[eye]);
        const blur = Math.max(0, d / 6);
        setBlur(blur);

        const sharp = (blur <= BLUR_OK) && !isBlinking();

        status.textContent = sharp ? '–°—Ç–∞–Ω: —á—ñ—Ç–∫–æ' : '–°—Ç–∞–Ω: –Ω–µ—á—ñ—Ç–∫–æ';
        focusOut.textContent = sharp ? '‚úî' : '‚Äì';

        if (!passed[eye] && holding && sharp){
            hold += 0.016; // ~60fps
            if (hold >= HOLD_SECONDS){
                passed[eye] = true;
                hold = 0;
                holding = false;
                stabilize.classList.remove('active');

                updateProgressText();

                if (eye === 'R'){
                    eye = 'L';
                    eyeBtn.textContent = '–õ–Ü–í–ï';
                    hint.textContent = '–¢–µ–ø–µ—Ä –ø–µ—Ä–µ–≤—ñ—Ä –ª—ñ–≤–µ –æ–∫–æ';
                } else {
                    // FINISH
                    finalLine.style.opacity = '1';
                    hint.textContent = '–ó –î–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è ü•≥';
                    status.textContent = '–°—Ç–∞–Ω: —ñ–¥–µ–∞–ª—å–Ω–æ';
                }
            }
        } else {
            // gentle decay, so blink doesn't ruin everything
            hold = Math.max(0, hold - 0.006);
        }

        holdOut.textContent = hold.toFixed(1) + ' c';
    }

    // Stabilize = press and hold
    stabilize.addEventListener('mousedown', () => {
        holding = true;
        stabilize.classList.add('active');
    });
    stabilize.addEventListener('mouseup', () => {
        holding = false;
        stabilize.classList.remove('active');
    });
    stabilize.addEventListener('mouseleave', () => {
        holding = false;
        stabilize.classList.remove('active');
    });

    stabilize.addEventListener('touchstart', (e) => {
        e.preventDefault();
        holding = true;
        stabilize.classList.add('active');
    }, { passive: false });
    stabilize.addEventListener('touchend', () => {
        holding = false;
        stabilize.classList.remove('active');
    });
    stabilize.addEventListener('touchcancel', () => {
        holding = false;
        stabilize.classList.remove('active');
    });

    // Eye switch (manual). If already passed both, it doesn't matter.
    eyeBtn.addEventListener('click', () => {
        eye = (eye === 'R') ? 'L' : 'R';
        eyeBtn.textContent = (eye === 'R') ? '–ü–†–ê–í–ï' : '–õ–Ü–í–ï';
        hold = 0;
    });

    // Blink loop (short, harmless)
    function blinkLoop(){
        // stop blinking after final reveal
        if (passed.R && passed.L) return;

        if (Math.random() < 0.012){
            blink.classList.add('on');
            setTimeout(() => blink.classList.remove('on'), 120);
        }
    }

    updateProgressText();
    setInterval(() => { update(); blinkLoop(); }, 16);
</script>
</body>
</html>
